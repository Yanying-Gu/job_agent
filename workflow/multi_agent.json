{
  "name": "workflow",
  "nodes": [
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are the master orchestration agent inside an n8n workflow dedicated to CV refinement. Your job is to coordinate specialist tool agents so the user receives an updated CV plus review insights aligned to the supplied job description. Skip interpreting or rewriting the job description yourself—simply pass the JSON payload onward.\n\nAVAILABLE TOOL AGENTS:\n- Update CV Agent\n- CV Review Agent \n\nDETAILED INSTRUCTIONS:\nSTEP 1 – Call Update CV Agent  \n- The job description JSON arrives as part of your input data (from the \"Call 'Load JD'\" workflow node). If you are unsure which key contains it, treat the entire input payload as `job_description_json`.  \n- CRITICAL: Store this payload in a variable named `job_description_json` BEFORE calling the Update CV tool so you can reuse it in Step 2.  \n- WHEN YOU START, CALL THE \"Update CV\" TOOL EXACTLY ONCE AND WAIT FOR ITS RESPONSE BEFORE DOING ANYTHING ELSE.  \n- Pass the stored `job_description_json` as the tool input (the tool description states \"The input is job description JSON that should be passed as the tool parameter\").  \n- It is acceptable if some fields are empty—only stop if the entire payload is completely missing. Otherwise proceed and note any gaps later.  \n- When the Update CV tool returns, capture the COMPLETE, VERBATIM response from the tool. This is the full updated project description text that the tool produced.  \n- CRITICAL: Store the ENTIRE tool response output as `updated_project_description`—do NOT summarize, paraphrase, or extract only parts of it. Copy the complete text exactly as returned by the tool.  \n- If the tool response contains multiple sections or formatting, include everything. The goal is to preserve the full updated project description text for the review step.  \n- Do not call the CV Review tool yet.\n\nSTEP 2 – Call CV Review Agent  \n- After Step 1 completes, call the \"CV review\" tool.  \n- CRITICAL: You MUST pass BOTH inputs to the CV Review tool:\n  1. The stored `updated_project_description` (the COMPLETE, VERBATIM text output from the Update CV tool in Step 1—do not summarize or truncate it)\n  2. The stored `job_description_json` (the same payload captured in Step 1, even if some fields are blank)\n- The tool description states \"Input should be job description and updated cv\" - so explicitly include BOTH values in your tool call. Format: pass both as separate parameters or as a combined object with both fields.  \n- If `updated_project_description` is missing or empty, stop and raise an error instead of calling the review tool.  \n- If `job_description_json` is missing entirely, note the issue and stop. If it exists but has empty fields, still pass it along unchanged.  \n- Request actionable feedback highlighting alignment strengths, gaps, and suggested tweaks.  \n- Wait for the CV Review response before moving on.\n\nSTEP 3 – Consolidate Output  \n- Combine the updated project description and the review feedback.  \n- Present the final response with two sections: `updated_project_description` and `review_summary`.  \n- Mention any assumptions or clarifications required from the user.\n\nGUARDRAILS:\n- Never fabricate new experience, skills, or metrics.  \n- Preserve sensitive data and confidentiality.  \n- Outputs are drafts intended for manual verification."
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -704,
        -320
      ],
      "id": "48c13c92-5cc9-4d35-a50a-21ae6672f08d",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "# item[\"output\"] is a escaped JSON, not a real dictionary\n# JSON data is stored inside a string, not as structured JSON\n# Need to unescape JSON\nimport json\n\nparsed_items = []\n\nfor item in _input.all():  # list of input items\n    data = item.get(\"json\", {})   # grab the nested json dict\n    raw_output = data.get(\"output\", \"\")  # now 'output' exists\n    if not raw_output:\n        parsed_items.append({\"raw_output\": \"MISSING\"})\n        continue\n    try:\n        parsed = json.loads(raw_output)  # convert string to dict\n        parsed_items.append(parsed)\n    except json.JSONDecodeError:\n        parsed_items.append({\"raw_output\": raw_output})\n\n# Return structured JSON back to n8n\nreturn parsed_items"
      },
      "id": "502ac4c3-bc11-4901-8ec2-01c795f5fb3b",
      "name": "Parse Master Output",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -416,
        -320
      ]
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        240,
        -48
      ],
      "id": "f484de3a-cdc7-4c44-971c-3d833c9d5c9d",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "S85Pqlm3N6Y4LMzn",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "toolDescription": "Call this tool to update resume. The input is job description JSON that should be passed as the tool parameter.",
        "text": "=You are the Update CV tool agent. \n\nINSTRUCTIONS:\n\nSTEP 1 – Load Current CV  \n- Call `Load_CV` tool to fetch the existing CV content.\n\n\nSTEP 2 – Extract Industry Focus  \n- For every project section in the CV, Based on target industry sector, {{ $json[\"Target Job Industry/Sector\"]}},\n  - Rephrase the project description so the achievements and impact clearly support that industry.  \n\nSTEP 3 – Return Updated Project Description  \n- Output the COMPLETE updated project description text. This must be the full, finished text ready for review—not a summary, not partial content, but the entire updated project description.  \n- The master agent will forward this exact text to the CV Review agent, so ensure it's complete and self-contained.  \n\n\nIMPORTANT GUARDRAILS:\n- Never fabricate experience, skills, or metrics.  \n- Keep the original tone, tense, and formatting where possible.  \n- Avoid repeating identical wording across projects."
      },
      "type": "@n8n/n8n-nodes-langchain.agentTool",
      "typeVersion": 2.2,
      "position": [
        -496,
        -64
      ],
      "id": "efb5d8f8-1801-4d5f-9e5c-ebc24e882066",
      "name": "Update CV"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -736,
        -112
      ],
      "id": "5ba2521e-6f5f-45c9-9c7e-30df86b7f245",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "S85Pqlm3N6Y4LMzn",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmOpenHuggingFaceInference",
      "typeVersion": 1,
      "position": [
        240,
        -240
      ],
      "id": "dc0f8db3-ef17-4c4f-95bc-692ae23b63f2",
      "name": "Hugging Face Inference Model",
      "credentials": {
        "huggingFaceApi": {
          "id": "C3TZmxIzvRywZME8",
          "name": "HuggingFaceApi account"
        }
      }
    },
    {
      "parameters": {
        "model": "qwen3:0.6b",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOllama",
      "typeVersion": 1,
      "position": [
        -544,
        144
      ],
      "id": "e09efeec-e3ca-448f-8a04-cd9b730754ff",
      "name": "Ollama Chat Model",
      "credentials": {
        "ollamaApi": {
          "id": "WUlsbk4h3gY3f8rM",
          "name": "Ollama account 2"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -1216,
        -288
      ],
      "id": "82026db2-502f-4f23-8617-69731486622f",
      "name": "When clicking ‘Execute workflow’"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "qqI7hVPaeHU4HmVO",
          "mode": "id",
          "cachedResultUrl": "/workflow/qqI7hVPaeHU4HmVO"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {
          "waitForSubWorkflow": true
        }
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -976,
        -288
      ],
      "id": "e77f7ca3-3177-4bdb-9a14-6491d771bda9",
      "name": "Call 'Load JD'"
    },
    {
      "parameters": {
        "description": "Call this tool after the resume is modified by Update CV Agent.\nSend the edited resume, and job description to this agent so it will review and return comment and mark."
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        384,
        -240
      ],
      "id": "5548bd40-8aaa-48ae-a9c4-09e9df0511c5",
      "name": "Call n8n Workflow Tool"
    },
    {
      "parameters": {
        "toolDescription": "Input should be job description and updated cv",
        "text": "You are the CV Review tool agent. The master agent sends you an updated project description together with the job description JSON so you can provide targeted feedback.\n\nTASK:\n- Evaluate how well the updated project description aligns with the provided job description.\n- Highlight strengths, gaps, and actionable recommendations without rewriting the project yourself.\n\nINPUTS PROVIDED BY MASTER AGENT:\n- Updated project description text.\n- Job description JSON (structured payload with role details, requirements, and context).\n\nINSTRUCTIONS:\n\nSTEP 1 – Validate Inputs  \n- If the updated project description text is missing or empty, immediately respond with \"Updated project description not provided\" and stop.\n\nSTEP 2 – Analyze Job Requirements  \n- Parse the job description JSON to identify role title, responsibilities, required skills, and any preferred qualifications.\n\nSTEP 3 – Review Updated Project Description  \n- Assess whether the description emphasizes relevant experience, achievements, and terminology that match the job description.  \n- Note areas where alignment is strong and where additional emphasis or clarification is needed.\n\nSTEP 4 – Produce Review Summary  \n- Return a concise evaluation with the following sections:  \n  - `strengths`: bullet points summarizing what the project description does well for this role.  \n  - `gaps`: bullet points explaining missing elements, unclear points, or weak alignment.  \n  - `recommendations`: actionable guidance for the CV author (no direct edits, just advice).  \n- Assign an overall alignment score from 1–5 (`5` meaning excellent fit) and explain the rationale.\n\nGUARDRAILS:\n- Do not fabricate qualifications or experiences.  \n- Do not rewrite the project text—focus on critique and guidance.  \n- Keep feedback professional, specific, and constructive."
      },
      "type": "@n8n/n8n-nodes-langchain.agentTool",
      "typeVersion": 2.2,
      "position": [
        -128,
        -64
      ],
      "id": "9534258f-6494-4aca-91ec-e35cd03111b7",
      "name": "CV review"
    },
    {
      "parameters": {
        "model": "qwen3:0.6b",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOllama",
      "typeVersion": 1,
      "position": [
        -128,
        128
      ],
      "id": "15eb2d80-814b-437d-a4fa-1d6837db7401",
      "name": "Ollama Chat Model1",
      "credentials": {
        "ollamaApi": {
          "id": "WUlsbk4h3gY3f8rM",
          "name": "Ollama account 2"
        }
      }
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "qqI7hVPaeHU4HmVO",
          "mode": "id",
          "cachedResultUrl": "/workflow/qqI7hVPaeHU4HmVO"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        256,
        112
      ],
      "id": "95d4f630-04dc-48a1-ab6a-4e09f127d83d",
      "name": "Load job description"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "PVWIW1TzkHvmqtT4",
          "mode": "id",
          "cachedResultUrl": "/workflow/PVWIW1TzkHvmqtT4"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false

